function J=fun(U)
global f H N WW G xx

% J=0;
% K=WW-G*U;
% l=G*U;
    b=0;
for i=1:N
% if U(i)+1>1e-1000000
        b=b-log((U(i)+1));%-0.5*u(j);       
% elseif    U(i)+1<0.0000001
%         b=b+0.5*(((U(i)+1-2*0.0000001)/0.0000001)^2-1)-log(0.0000001);
% end
% if -U(i)+1>1e-1000000
        b=b-log((-U(i)+1));%-0.5*u(j);       
% elseif    -U(i)+1<0.000001
%         b=b+0.5*(((-U(i)+1-2*0.0000001)/0.0000001)^2-1)-log(0.0000001);
% end
% % -log((1-U(i)))
%     b1=0;
%     for j=1:1
%         b=b-log((1-U(i)))-log((U(i)+1));%-0.5*u(j);       
%     end

%     b1=b1+log(3)-log(3-x(1,i))+1/3*x(1,i);
%    J=J+.5*x(:,i+1)'*x(:,i+1)+.5*u(i)'*0.1*u(i)+1e-10*b;
end

        if (xx(2)+.1*U(1)+2)<1e-2%(xx(1)+2)<1e-5%
             b=b+0.5*(((xx(2)+.1*U(1)+2-2*0.01)/0.01)^2-1)-log(0.01)+.5*(xx(2)+.1*U(1))+log(2);
%                 b=b+0.5*(((xx(1)+2-2*0.000001)/0.000001)^2-1)-log(0.000001)+.5*(xx(1))+log(2);
        else
         b=b-log(xx(2)+.1*U(1)+2)+log(2)+0.5*(xx(2)+.1*U(1));%+log(WW(j));%+log(WW(j)-l(j))+G(j,i)*U(i);
%           b=b-log(xx(1)+2)+log(2)+0.5*(xx(1));%+log(WW(j));%+log(WW(j)-l(j))+G(j,i)*U(i);

        end
%     

J=.5*U'*H*U+f'*U+.001*b;